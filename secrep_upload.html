<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neues Rezept - Knuffis Rezepte</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Fredoka', sans-serif; background-color: #faf9f6; }
        textarea, input[type="text"], input[type="email"] { 
            background: rgba(255,255,255,0.5); 
            transition: all 0.3s;
        }
        textarea:focus, input:focus { 
            background: white; 
            outline: 2px dashed #FF9F1C; 
        }
    </style>
</head>
<body class="text-gray-800 p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-orange-600 mb-2">Rezept Einsenden üßë‚Äçüç≥</h1>
            <p class="font-bold text-gray-600">Tippe dein Rezept einfach direkt in die Karte! Es sieht sp√§ter (fast) genau so aus.</p>
            <p class="text-sm text-gray-500 mt-4 bg-gray-200 inline-block px-4 py-1 rounded-full">
                Alle Felder mit einem <span class="text-orange-500 font-bold text-lg">*</span> sind Pflichtfelder. Der Rest ist freiwillig!
            </p>
        </div>

        <form action="https://formsubmit.co/lars.krahnen@gmail.com" method="POST" enctype="multipart/form-data" onsubmit="baueCodeZusammen()" class="bg-white rounded-[2rem] border-4 border-gray-900 shadow-[8px_8px_0px_0px_#1f2937] overflow-hidden">
            
            <input type="hidden" name="_captcha" value="false">
            <input type="hidden" name="_subject" value="Neues Rezept f√ºr Knuffi!">
            <input type="hidden" name="FUEGE_DAS_IN_DIE_REZEPTE_JS_EIN" id="fertiger_code">

            <div class="h-48 bg-gray-100 border-b-4 border-gray-900 flex flex-col items-center justify-center relative p-4 cursor-pointer hover:bg-gray-200 transition" onclick="document.getElementById('i_bild_upload').click()">
                <span class="text-4xl mb-2">üì∏</span>
                <p class="font-bold text-gray-600 text-center">Klicke hier, um ein Rezeptbild hochzuladen<br><span class="text-sm font-normal text-gray-500">(Optional)</span></p>
                <input type="file" id="i_bild_upload" name="attachment" accept="image/jpeg, image/png, image/webp" class="hidden" onchange="zeigeDateinamen(this)">
                <p id="dateiname_anzeige" class="text-sm text-orange-600 font-bold mt-2 hidden"></p>
            </div>

            <div class="p-6 md:p-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 bg-orange-50 p-4 rounded-2xl border-2 border-orange-200">
                    <div>
                        <label class="block font-bold text-sm text-orange-800 mb-1">Dein Name (Autor) <span class="text-orange-500">*</span></label>
                        <input type="text" id="i_autor" name="autor" required class="w-full border-2 border-gray-300 p-2 rounded-xl" placeholder="Wie sollen wir dich nennen?">
                    </div>
                    <div>
                        <label class="block font-bold text-sm text-orange-800 mb-1">Deine E-Mail <span class="text-gray-500 font-normal">(Optional, f√ºr R√ºckfragen)</span></label>
                        <input type="email" name="email" class="w-full border-2 border-gray-300 p-2 rounded-xl" placeholder="max@muster.de">
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block font-bold text-xs text-orange-500 uppercase tracking-wide mb-1">Rezept-Titel *</label>
                    <input type="text" id="i_titel" required class="w-full text-3xl md:text-5xl font-extrabold text-gray-900 p-2 border-b-4 border-dashed border-gray-300" placeholder="z.B. Omas Apfelkuchen">
                </div>

                <div class="flex flex-wrap gap-4 mb-10 border-t-2 border-b-2 border-gray-100 py-4">
                    <div class="flex-1 min-w-[120px]">
                        <label class="block font-bold text-xs text-gray-400 uppercase tracking-wide">Zeitaufwand <span class="text-orange-500">*</span></label>
                        <input type="text" id="i_zeit" required class="w-full font-bold text-lg p-1" placeholder="z.B. 20 Min.">
                    </div>
                    <div class="flex-1 min-w-[120px]">
                        <label class="block font-bold text-xs text-gray-400 uppercase tracking-wide">Portionen <span class="text-orange-500">*</span></label>
                        <input type="text" id="i_portionen" required class="w-full font-bold text-lg p-1" placeholder="z.B. 4 Portionen">
                    </div>
                    <div class="flex-1 min-w-[120px]">
                        <label class="block font-bold text-xs text-gray-400 uppercase tracking-wide">Kategorie <span class="text-orange-500">*</span></label>
                        <input type="text" id="i_kategorie" required class="w-full font-bold text-lg p-1" placeholder="z.B. Hauptgericht">
                    </div>
                    <div class="flex-1 min-w-[120px]">
                        <label class="block font-bold text-xs text-gray-400 uppercase tracking-wide">Inspiration <span class="text-gray-400 font-normal">(Optional)</span></label>
                        <input type="text" id="i_inspiration" class="w-full font-bold text-lg p-1" placeholder="z.B. Von Mama">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-12 gap-10">
                    <div class="md:col-span-4 bg-gray-50 p-6 rounded-2xl border-4 border-gray-900 h-fit shadow-[4px_4px_0px_0px_#1f2937]">
                        <h2 class="text-2xl font-extrabold mb-2 flex items-center gap-2">üõí Zutaten <span class="text-orange-500">*</span></h2>
                        <p class="text-xs text-gray-500 font-bold mb-4">Einfach untereinander schreiben:</p>
                        <textarea id="i_zutaten" required rows="10" class="w-full resize-none font-medium leading-relaxed p-2" placeholder="500g Hackfleisch&#10;1 Zwiebel&#10;Salz & Pfeffer"></textarea>
                    </div>

                    <div class="md:col-span-8">
                        <h2 class="text-3xl font-extrabold mb-4 flex items-center gap-2">üë®‚Äçüç≥ Zubereitung <span class="text-orange-500">*</span></h2>
                        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-3 mb-4 text-sm text-blue-800 font-medium">
                            <strong>Tipp:</strong> Wenn du deinem Schritt einen Titel geben willst, nutze einen Doppelpunkt! <br>
                            <em>Beispiel:</em> <strong>Anbraten:</strong> Das Fleisch in die Pfanne werfen...
                        </div>
                        <textarea id="i_zubereitung" required rows="12" class="w-full resize-none font-medium leading-relaxed p-4 border-2 border-gray-200 rounded-2xl" placeholder="Vorbereitung: Den Ofen auf 200 Grad vorheizen.&#10;&#10;Anbraten: Die Zwiebeln w√ºrfeln und in der Pfanne glasig d√ºnsten..."></textarea>
                    </div>
                </div>

                <div class="mt-12 text-center">
                    <button type="submit" class="bg-[#FF9F1C] text-gray-900 px-10 py-4 rounded-xl font-extrabold text-2xl border-4 border-gray-900 shadow-[6px_6px_0px_0px_#1f2937] hover:shadow-none hover:translate-x-[6px] hover:translate-y-[6px] transition">
                        üöÄ Rezept an Knuffi senden
                    </button>
                </div>

            </div>
        </form>
    </div>

    <script>
        // Zeigt dem Nutzer an, welches Bild er ausgew√§hlt hat
        function zeigeDateinamen(input) {
            const anzeige = document.getElementById('dateiname_anzeige');
            if (input.files && input.files[0]) {
                anzeige.innerText = "Ausgew√§hltes Bild: " + input.files[0].name;
                anzeige.classList.remove('hidden');
            }
        }

        function baueCodeZusammen() {
            const titel = document.getElementById('i_titel').value.trim();
            const zeit = document.getElementById('i_zeit').value.trim();
            const portionen = document.getElementById('i_portionen').value.trim();
            const kategorie = document.getElementById('i_kategorie').value.trim();
            const autor = document.getElementById('i_autor').value.trim();
            const inspiration = document.getElementById('i_inspiration').value.trim();
            
            let id = titel.toLowerCase().replace(/[^a-z0-9√§√∂√º√ü]+/g, '_').replace(/(^_|_$)/g, '');
            if(!id) id = "neues_rezept";

            // Der Pfad wird hier automatisch generiert, auch wenn kein Bild hochgeladen wird.
            // (Dann greift sp√§ter auf der Webseite einfach dein sch√∂ner Platzhalter!)
            const bild = "bilder/" + id + ".jpg";

            const datum = new Date().toLocaleDateString('de-DE', {day: '2-digit', month: '2-digit', year: 'numeric'});

            const zutatenRaw = document.getElementById('i_zutaten').value.split('\n').filter(z => z.trim() !== '');
            let zutatenString = '';
            zutatenRaw.forEach((z, i) => {
                zutatenString += `            "${z.trim()}"${i < zutatenRaw.length - 1 ? ',' : ''}\n`;
            });

            const zubereitungRaw = document.getElementById('i_zubereitung').value.split('\n').filter(s => s.trim() !== '');
            let zubereitungString = '';
            let stepCount = 1;
            
            zubereitungRaw.forEach((step, i) => {
                let stepTitle = `Schritt ${stepCount}`;
                let stepText = step.trim();
                
                if(stepText.includes(':')) {
                    const firstColonIndex = stepText.indexOf(':');
                    stepTitle = stepText.substring(0, firstColonIndex).trim();
                    stepText = stepText.substring(firstColonIndex + 1).trim();
                }
                
                zubereitungString += `            { \n                titel: "${stepTitle}", \n                text: "${stepText}" \n            }${i < zubereitungRaw.length - 1 ? ',' : ''}\n`;
                stepCount++;
            });

            const finalCode = `
    "${id}": {
        titel: "${titel}",
        bild: "${bild}",
        zeit: "${zeit}",
        portionen: "${portionen}",
        kategorie: "${kategorie}",
        autor: "${autor}",
        datum: "${datum}",
        inspiration: "${inspiration}",
        zutaten: [
${zutatenString}        ],
        zubereitung: [
${zubereitungString}        ]
    },`;

            document.getElementById('fertiger_code').value = finalCode;
        }
    </script>
</body>
</html>
